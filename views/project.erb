<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#712cf9">
    <title>Container CI</title>
    <style>
      html,
      body {
        overflow-x: hidden; /* Prevent scroll on narrow devices */
      }

      body {
        padding-top: 56px;
      }

      .nav-scroller .nav {
        color: rgba(255, 255, 255, .75);
      }

      .nav-scroller .nav-link {
        padding-top: .75rem;
        padding-bottom: .75rem;
        font-size: .875rem;
        color: #6c757d;
      }

      .nav-scroller .nav-link:hover {
        color: #007bff;
      }

      .nav-scroller .active {
        font-weight: 500;
        color: #343a40;
      }

      .bg-purple {
        background-color: #6f42c1;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      i.spinner-border {
        --bs-spinner-width: 1.5rem;
        --bs-spinner-height: 1.5rem;
        --bs-spinner-border-width: 0.15em;
      }

      .popover {
        --bs-popover-max-width: auto !important;
      }
    </style>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-icons.css">
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
function build(trigger_id) {
  $.ajax({
    type: "POST",
    url: "/trigger/" + trigger_id,
    data: { "branch": "main" },
    success: function (result) {
      $("#trigger-success").show(); 
      window.setTimeout(function () { 
         $("#trigger-success").alert('close'); 
      }, 2000);
    },
    error: function (result, status) {
      $("#trigger-error").show(); 
    }
  });
}

$(document).ready(function(){
  const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
  const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
});
    </script>
  </head>
  <body class="bg-light">
  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark" aria-label="Main navigation">
  <div class="container-fluid">
    <a class="navbar-brand" href="/"><i class="bi bi-box align-top me-3"></i>Container CI</a>
  </div>
  </nav>

  <div class="nav-scroller bg-body shadow-sm">
  <nav class="nav" aria-label="Secondary navigation">
    <a class="nav-link active" aria-current="page" href="/">Dashboard</a>
    <!-- <a class="nav-link" href="#">CustomLink</a> -->
  </nav>
  </div>

  <main class="container">
  <div class="d-flex align-items-center p-3 my-3 text-white bg-purple rounded shadow-sm">
    <i class="bi bi-box me-3" width="48" height="38"></i>
    <div class="lh-1">
      <h1 class="h6 mb-0 text-white lh-1"><%= @project.name %></h1>
    </div>
  </div>

  <div class="my-3 p-3 bg-body rounded shadow-sm">
    <table class="table">
      <tr>
        <th scope="col">Build</th>
        <th scope="col">Steps</th>
      </tr>
    <% @project.builds.reverse_each do |key, value| %>
      <tr>
        <td><%= key %></td>
        <td>
        <% value.steps.each do |step, output| %>
          <button type="button" class="btn <%= @status[output['status']] %>" data-bs-toggle="popover" data-bs-title="<%= step %>" data-bs-content="<%= output['message'] %>" data-bs-html="true"><%= step %></button>
        <% end %>
        </td>
      </tr>
    <% end %>
    </table>
  </div>
  </main>
  </body>
</html>
